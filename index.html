<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>My GradeBook</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #f0f4f8 0%, #e0e7ef 100%);
    margin: 0;
    padding: 20px;
    color: #333;
  }

  h1 {
    text-align: center;
    margin-bottom: 40px;
    font-weight: 700;
    font-size: 2rem;
    color: #333;
  }

  #main-view {
    max-width: 1200px;
    margin: 0 auto;
  }

  .course-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    grid-gap: 20px;
    margin-bottom: 20px;
  }

  .card {
    background:#fff;
    border-radius: 20px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
    padding:20px;
  }

  .course-card {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 150px;
    text-align: center;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    cursor: pointer;
  }

  .course-card h2 {
    margin: 0;
    font-size: 1.3rem;
    font-weight: 600;
    color: #333;
  }

  .course-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
  }

  .add-course-card {
    background-color: #92B4EC; 
    color: #fff;
  }

  #course-details {
    max-width: 1200px;
    margin: 0 auto;
  }

  #course-details-container {
    margin-bottom: 20px;
  }

  #back-btn {
    display:inline-block;
    margin-bottom:20px;
    cursor:pointer;
    color:#92B4EC;
    text-decoration:none;
    font-weight:500;
  }

  #back-btn:hover {
    text-decoration:underline;
  }

  #course-name-title {
    margin-top:0;
    font-size:1.5rem;
    margin-bottom:20px;
  }

  table {
    width:100%;
    border-collapse: collapse;
    margin-bottom:20px;
  }

  table th, table td {
    text-align:left;
    padding:8px;
    border-bottom:1px solid #eee;
    font-size:0.9rem;
  }

  button {
    background:#92B4EC;
    color:#fff;
    border:none;
    padding:10px 15px;
    border-radius:10px;
    cursor:pointer;
    font-size:0.9rem;
    margin-right: 10px;
    font-weight:500;
  }

  button:hover {
    background:#7fa2dd;
  }

  .block-section {
    margin-bottom:20px;
  }

  .block-section h3 {
    margin-top:0;
    font-size:1.2rem;
    margin-bottom:15px;
    color:#333;
    font-weight:600;
  }

  .block-section label, .block-section p {
    font-size:0.9rem;
    margin-bottom:10px;
    display:block;
    font-weight:500;
  }

  .block-section input, .block-section select {
    width:100%;
    padding:10px;
    border:1px solid #ccc;
    border-radius:10px;
    margin-bottom:10px;
    font-size:0.9rem;
    font-family:'Poppins', sans-serif;
    font-weight:400;
  }

  #conversion-results p {
    margin:5px 0;
    font-size:0.9rem;
  }

  .hidden {
    display:none;
  }

  /* Modal styling */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    right:0;
    bottom:0;
    background: rgba(0,0,0,0.5);
    display:flex;
    justify-content:center;
    align-items:center;
    opacity:0;
    pointer-events:none;
    transition: opacity 0.2s;
    z-index: 999;
  }

  .modal.active {
    opacity:1;
    pointer-events: auto;
  }

  .modal-content {
    background:#fff;
    border-radius:20px;
    padding:20px;
    min-width:300px;
    max-width:400px;
    box-shadow:0 2px 10px rgba(0,0,0,0.2);
    position: relative;
  }

  .modal-content h3 {
    margin-top:0;
    font-size:1.2rem;
    margin-bottom:15px;
    color:#333;
    font-weight:600;
  }

  .modal-content input, 
  .modal-content select {
    width:100%;
    padding:10px;
    margin-bottom:10px;
    border:1px solid #ccc;
    border-radius:10px;
    font-family:'Poppins', sans-serif;
    font-size:0.9rem;
  }

  .modal-content button {
    margin-right:10px;
  }
</style>
</head>
<body>
  <h1>My GradeBook</h1>

  <div id="main-view">
    <div class="course-container" id="course-container">
      <!-- Courses will be rendered here -->
    </div>
    <div class="course-container">
      <div class="course-card add-course-card" id="add-course-btn">
        <h2>Add New Course</h2>
      </div>
    </div>
  </div>

  <div id="course-details" class="hidden">
    <a href="#" id="back-btn">&larr; Back to Courses</a>
    <div id="course-details-container" class="card">
      <h2 id="course-name-title"></h2>
      <table>
        <thead>
          <tr>
            <th>Name</th><th>Type</th><th>Score</th><th>Out Of</th><th>Weight (%)</th><th>Contribution</th>
          </tr>
        </thead>
        <tbody id="grade-components-body"></tbody>
      </table>
      <button id="add-component-btn">Add Component</button>
    </div>

    <div class="block-section card">
      <h3>Final Grade Requirement</h3>
      <label for="desired-grade">Desired Final Grade (%)</label>
      <input type="number" id="desired-grade" placeholder="e.g. 90">
      <button id="calc-final-needs">Calculate Needed Final</button>
      <div id="final-needed-result" style="margin-top:10px; font-size:0.9rem;"></div>
    </div>

    <div class="block-section card">
      <h3>GPA Converter</h3>
      <label for="input-type">Input Type:</label>
      <select id="input-type">
        <option value="percentage">Percentage</option>
        <option value="letter">Letter Grade</option>
      </select>
      
      <div id="percentage-input-group">
        <label for="percentage-input">Enter Percentage:</label>
        <input type="number" id="percentage-input" placeholder="e.g. 87">
      </div>

      <div id="letter-input-group" class="hidden">
        <label for="letter-input">Enter Letter Grade:</label>
        <select id="letter-input">
          <option value="A+">A+</option>
          <option value="A">A</option>
          <option value="A-">A-</option>
          <option value="B+">B+</option>
          <option value="B">B</option>
          <option value="B-">B-</option>
          <option value="C+">C+</option>
          <option value="C">C</option>
          <option value="C-">C-</option>
          <option value="D+">D+</option>
          <option value="D">D</option>
          <option value="D-">D-</option>
          <option value="F">F</option>
        </select>
      </div>

      <label for="convert-scale">Convert To Scale:</label>
      <select id="convert-scale">
        <option value="all">Show All</option>
        <option value="4.0">4.0 Scale</option>
        <option value="4.3">4.3 Scale (Queen's)</option>
        <option value="12">12 Point Scale (McMaster)</option>
      </select>

      <button id="gpa-convert-btn">Convert</button>
      <div id="conversion-results" style="margin-top:10px;"></div>
    </div>
  </div>

  <!-- Add Course Modal -->
  <div class="modal" id="add-course-modal">
    <div class="modal-content">
      <h3>Add Course</h3>
      <input type="text" id="new-course-name" placeholder="Course Name"/>
      <button id="save-course">Save</button>
      <button id="close-course-modal">Cancel</button>
    </div>
  </div>

  <!-- Add Component Modal -->
  <div class="modal" id="add-component-modal">
    <div class="modal-content">
      <h3>Add Component</h3>
      <input type="text" id="component-name" placeholder="Component Name (e.g. Quiz 1)"/>
      <input type="text" id="component-type" placeholder="Type (Quiz, Assignment, Exam)"/>
      <input type="number" id="component-score" placeholder="Score Earned"/>
      <input type="number" id="component-outof" placeholder="Out Of"/>
      <input type="number" id="component-weight" placeholder="Weight (%)"/>
      <button id="save-component">Save</button>
      <button id="close-component-modal">Cancel</button>
    </div>
  </div>

<script>
let courses = JSON.parse(localStorage.getItem('courses')) || [];
let selectedCourseIndex = null;

const courseContainer = document.getElementById('course-container');
const addCourseBtn = document.getElementById('add-course-btn');
const addCourseModal = document.getElementById('add-course-modal');
const closeCourseModalBtn = document.getElementById('close-course-modal');
const saveCourseBtn = document.getElementById('save-course');
const newCourseName = document.getElementById('new-course-name');

const courseDetails = document.getElementById('course-details');
const courseNameTitle = document.getElementById('course-name-title');
const gradeComponentsBody = document.getElementById('grade-components-body');
const backBtn = document.getElementById('back-btn');
const addComponentBtn = document.getElementById('add-component-btn');

const addComponentModal = document.getElementById('add-component-modal');
const closeComponentModalBtn = document.getElementById('close-component-modal');
const saveComponentBtn = document.getElementById('save-component');
const componentNameInput = document.getElementById('component-name');
const componentTypeInput = document.getElementById('component-type');
const componentScoreInput = document.getElementById('component-score');
const componentOutOfInput = document.getElementById('component-outof');
const componentWeightInput = document.getElementById('component-weight');

const desiredGradeInput = document.getElementById('desired-grade');
const calcFinalNeedsBtn = document.getElementById('calc-final-needs');
const finalNeededResult = document.getElementById('final-needed-result');

const inputTypeSelect = document.getElementById('input-type');
const percentageInput = document.getElementById('percentage-input');
const letterInput = document.getElementById('letter-input');
const convertScaleSelect = document.getElementById('convert-scale');
const gpaConvertBtn = document.getElementById('gpa-convert-btn');
const conversionResults = document.getElementById('conversion-results');

const percentageInputGroup = document.getElementById('percentage-input-group');
const letterInputGroup = document.getElementById('letter-input-group');

function saveCourses() {
  localStorage.setItem('courses', JSON.stringify(courses));
}

function renderCourses() {
  courseContainer.innerHTML = '';
  courses.forEach((course, index) => {
    const div = document.createElement('div');
    div.className = 'course-card card';
    div.innerHTML = `<h2>${course.name}</h2>`;
    div.addEventListener('click', () => showCourseDetails(index));
    courseContainer.appendChild(div);
  });
}

function showCourseDetails(index) {
  selectedCourseIndex = index;
  const course = courses[index];
  document.getElementById('main-view').classList.add('hidden');
  courseDetails.classList.remove('hidden');
  courseNameTitle.textContent = course.name;
  renderGradeComponents();
}

function renderGradeComponents() {
  const course = courses[selectedCourseIndex];
  gradeComponentsBody.innerHTML = course.gradeComponents.map(c => {
    const contribution = ((c.score / c.outOf) * c.weight).toFixed(2);
    return `<tr>
      <td>${c.name}</td>
      <td>${c.type}</td>
      <td>${c.score}</td>
      <td>${c.outOf}</td>
      <td>${c.weight}</td>
      <td>${contribution}%</td>
    </tr>`;
  }).join('');
}

function openAddCourseModal() {
  addCourseModal.classList.add('active');
  newCourseName.value = '';
}

function closeAddCourseModal() {
  addCourseModal.classList.remove('active');
}

function openAddComponentModal() {
  addComponentModal.classList.add('active');
  componentNameInput.value = '';
  componentTypeInput.value = '';
  componentScoreInput.value = '';
  componentOutOfInput.value = '';
  componentWeightInput.value = '';
}

function closeAddComponentModal() {
  addComponentModal.classList.remove('active');
}

function calculateNeededFinalScore() {
  const desired = parseFloat(desiredGradeInput.value);
  if (isNaN(desired)) {
    finalNeededResult.textContent = "Please enter a valid desired grade.";
    return;
  }

  const course = courses[selectedCourseIndex];
  const finalComponents = course.gradeComponents.filter(c => c.type.toLowerCase().includes('final'));
  if (finalComponents.length === 0) {
    finalNeededResult.textContent = "No final component found. Please add a final exam/component.";
    return;
  }

  const finalExam = finalComponents[finalComponents.length - 1];
  let currentWeightedGrade = 0;
  course.gradeComponents.forEach(c => {
    if (c !== finalExam) {
      currentWeightedGrade += (c.score / c.outOf) * c.weight;
    }
  });

  const finalWeight = finalExam.weight;
  const totalWeight = 100;
  const neededFraction = (desired * totalWeight - currentWeightedGrade) / finalWeight;
  const neededScore = neededFraction * finalExam.outOf;

  if (neededScore > finalExam.outOf) {
    finalNeededResult.textContent = `You would need more than ${finalExam.outOf} out of ${finalExam.outOf}, which is not possible.`;
  } else if (neededScore < 0) {
    finalNeededResult.textContent = "You have already secured this grade or above without the final.";
  } else {
    finalNeededResult.textContent = `You need ${neededScore.toFixed(2)} out of ${finalExam.outOf} on the final to achieve ${desired}% in the course.`;
  }
}

function percentageToLetter(percentage) {
  if (percentage >= 90) return 'A+';
  else if (percentage >= 85) return 'A';
  else if (percentage >= 80) return 'A-';
  else if (percentage >= 77) return 'B+';
  else if (percentage >= 73) return 'B';
  else if (percentage >= 70) return 'B-';
  else if (percentage >= 67) return 'C+';
  else if (percentage >= 63) return 'C';
  else if (percentage >= 60) return 'C-';
  else if (percentage >= 57) return 'D+';
  else if (percentage >= 53) return 'D';
  else if (percentage >= 50) return 'D-';
  return 'F';
}

function letterToFourPointScale(letter) {
  switch (letter) {
    case 'A+': case 'A': return 4.0;
    case 'A-': return 3.7;
    case 'B+': return 3.3;
    case 'B': return 3.0;
    case 'B-': return 2.7;
    case 'C+': return 2.3;
    case 'C': return 2.0;
    case 'C-': return 1.7;
    case 'D+': return 1.3;
    case 'D': return 1.0;
    case 'D-': return 0.7;
    default: return 0.0;
  }
}

function letterToFourPointThreeScale(letter) {
  switch (letter) {
    case 'A+': return 4.3;
    case 'A': return 4.0;
    case 'A-': return 3.7;
    case 'B+': return 3.3;
    case 'B': return 3.0;
    case 'B-': return 2.7;
    case 'C+': return 2.3;
    case 'C': return 2.0;
    case 'C-': return 1.7;
    case 'D+': return 1.3;
    case 'D': return 1.0;
    case 'D-': return 0.7;
    default: return 0.0;
  }
}

function letterToTwelveScale(letter) {
  // Approximate McMaster scale
  switch (letter) {
    case 'A+': return 12;
    case 'A': return 11;
    case 'A-': return 10;
    case 'B+': return 9;
    case 'B': return 8;
    case 'B-': return 7;
    case 'C+': return 6;
    case 'C': return 5;
    case 'C-': return 4;
    case 'D+': return 3;
    case 'D': return 2;
    case 'D-': return 1;
    default: return 0;
  }
}

function convertGrade() {
  const inputType = inputTypeSelect.value;
  const scale = convertScaleSelect.value;
  let letter;

  if (inputType === 'percentage') {
    const perc = parseFloat(percentageInput.value);
    if (isNaN(perc)) {
      conversionResults.textContent = "Please enter a valid percentage.";
      return;
    }
    letter = percentageToLetter(perc);
  } else {
    letter = letterInput.value;
  }

  const fourPoint = letterToFourPointScale(letter);
  const fourPointThree = letterToFourPointThreeScale(letter);
  const twelve = letterToTwelveScale(letter);

  let resultHTML = '';
  if (scale === 'all') {
    resultHTML = `
      <p>Input Letter Grade: ${letter}</p>
      <p>4.0 Scale: ${fourPoint}</p>
      <p>4.3 Scale (Queen's): ${fourPointThree}</p>
      <p>12 Point Scale (McMaster): ${twelve}</p>
    `;
  } else if (scale === '4.0') {
    resultHTML = `<p>${letter} on 4.0 Scale: ${fourPoint}</p>`;
  } else if (scale === '4.3') {
    resultHTML = `<p>${letter} on 4.3 Scale: ${fourPointThree}</p>`;
  } else if (scale === '12') {
    resultHTML = `<p>${letter} on 12 Point Scale: ${twelve}</p>`;
  }

  conversionResults.innerHTML = resultHTML;
}

// Event Listeners
addCourseBtn.addEventListener('click', openAddCourseModal);
document.getElementById('close-course-modal').addEventListener('click', closeAddCourseModal);

saveCourseBtn.addEventListener('click', () => {
  const name = newCourseName.value.trim();
  if (name) {
    courses.push({ name, gradeComponents: [] });
    saveCourses();
    closeAddCourseModal();
    renderCourses();
  }
});

backBtn.addEventListener('click', (e) => {
  e.preventDefault();
  courseDetails.classList.add('hidden');
  document.getElementById('main-view').classList.remove('hidden');
  renderCourses();
});

addComponentBtn.addEventListener('click', openAddComponentModal);
document.getElementById('close-component-modal').addEventListener('click', closeAddComponentModal);

saveComponentBtn.addEventListener('click', () => {
  const compName = componentNameInput.value.trim();
  const compType = componentTypeInput.value.trim();
  const compScore = parseFloat(componentScoreInput.value);
  const compOutOf = parseFloat(componentOutOfInput.value);
  const compWeight = parseFloat(componentWeightInput.value);

  if (compName && compType && !isNaN(compScore) && !isNaN(compOutOf) && !isNaN(compWeight)) {
    courses[selectedCourseIndex].gradeComponents.push({
      name: compName, type: compType, score: compScore, outOf: compOutOf, weight: compWeight
    });
    saveCourses();
    closeAddComponentModal();
    renderGradeComponents();
  }
});

calcFinalNeedsBtn.addEventListener('click', calculateNeededFinalScore);
gpaConvertBtn.addEventListener('click', convertGrade);

inputTypeSelect.addEventListener('change', () => {
  if (inputTypeSelect.value === 'percentage') {
    percentageInputGroup.classList.remove('hidden');
    letterInputGroup.classList.add('hidden');
  } else {
    percentageInputGroup.classList.add('hidden');
    letterInputGroup.classList.remove('hidden');
  }
});

// Initial Render
renderCourses();
</script>
</body>
</html>
